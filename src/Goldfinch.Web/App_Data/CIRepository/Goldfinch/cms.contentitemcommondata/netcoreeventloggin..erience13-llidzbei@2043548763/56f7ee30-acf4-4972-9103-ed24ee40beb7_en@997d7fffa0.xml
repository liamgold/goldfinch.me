<?xml version="1.0" encoding="utf-8"?>
<cms.contentitemcommondata>
  <ContentItemCommonDataContentItemID>
    <CodeName>NETCoreEventLoggingInKenticoXperience13-llidzbei</CodeName>
    <GUID>92b2acc4-f90b-4814-b7cb-652e2bbc5491</GUID>
    <ObjectType>cms.contentitem</ObjectType>
  </ContentItemCommonDataContentItemID>
  <ContentItemCommonDataContentLanguageID>
    <CodeName>en</CodeName>
    <GUID>22960170-5c33-4d4e-a01b-fd4c8fcbd13d</GUID>
    <ObjectType>cms.contentlanguage</ObjectType>
  </ContentItemCommonDataContentLanguageID>
  <ContentItemCommonDataGUID>56f7ee30-acf4-4972-9103-ed24ee40beb7</ContentItemCommonDataGUID>
  <ContentItemCommonDataIsLatest>True</ContentItemCommonDataIsLatest>
  <ContentItemCommonDataLastPublishedWhen>2024-07-13 00:58:32Z</ContentItemCommonDataLastPublishedWhen>
  <ContentItemCommonDataVersionStatus>2</ContentItemCommonDataVersionStatus>
  <ContentItemCommonDataVisualBuilderWidgets>
    <![CDATA[{"editableAreas":[{"identifier":"BlogPost","sections":[{"identifier":"a1125552-942d-4d04-90ff-d76830b691c0","type":"Kentico.DefaultSection","properties":null,"zones":[{"identifier":"9d5d6dd7-d4c0-466a-8f17-a136fee637a8","widgets":[{"identifier":"dfec185b-26e7-4926-8e87-d7ef9719a289","type":"Kentico.Widget.RichText","variants":[{"identifier":"6676ab38-ce18-4301-a9c6-4cc11f8d9e79","properties":{"content":"<p>When Kentico Xperience 13 was launched, we gained the ability to build websites using ASP.NET Core 😁. &nbsp;Behind the scenes, a lot of Xperience's core libraries had to be rewritten and migrated, so that they were compatible with .NET Core.</p><p>When creating a new Xperience site using .NET Core, you'll need to ensure you are <a href=\"https://docs.xperience.io/developing-websites/developing-xperience-applications-using-asp-net-core/starting-with-asp-net-core-development#StartingwithASP.NETCoredevelopment-Configuringapplicationstartup\" rel=\"noopener noreferrer\" target=\"_blank\">registering</a> the services correctly in the application's Startup<strong>&nbsp;</strong>class.</p><p><strong>Event logging in .NET Core</strong></p><p>One of the features introduced by the AddKentico() service is the KenticoEventLog logger. &nbsp;This logger introduces the ability to <a href=\"https://docs.xperience.io/13api/configuration/event-log#Eventlog-Loggingevents\" rel=\"noopener noreferrer\" target=\"_blank\">log events</a> from the .NET Core website, and displays them in the Event Log module within the admin site. &nbsp;You can log error messages, exceptions, warnings or even just debug information to assist with troubleshooting problems. &nbsp;The logger itself is built using the <a href=\"https://docs.microsoft.com/aspnet/core/fundamentals/logging/?view=aspnetcore-3.1\" rel=\"noopener noreferrer\" target=\"_blank\">.NET Core logging API</a>, so it should be easy to use and recognisable by ASP.NET Core developers.</p><p>However, this is where we hit a problem - the current implementation of the KenticoEventLog logger doesn't appear to fully recognise values set in the website appsettings.json like it should. &nbsp;Lets explore this in more detail!</p><p><strong>Scenario 1 - default setup</strong></p><p>Lets take a look at the default appsettings.json for the base .NET Core site provided by the installer (or the Dancing Goat sample site), it should look something like this:</p>"},"fieldIdentifiers":{"content":"34e17c84-4ad5-44ed-803d-04ba48f11f1d"}}]},{"identifier":"24aa69f5-bbd3-4baf-8a93-b01952b22a16","type":"Goldfinch.CodeBlockWidget","variants":[{"identifier":"2d99598e-fc5b-495f-94e8-102ec486d76b","properties":{"language":"javascript","code":"{\r\n  \"Logging\": {\r\n    \"LogLevel\": {\r\n      \"Default\": \"Information\",\r\n      \"Microsoft\": \"Warning\",\r\n      \"Microsoft.Hosting.Lifetime\": \"Information\"\r\n    },\r\n    \"KenticoEventLog\": {\r\n      \"LogLevel\": {\r\n        \"Default\": \"Error\",\r\n        \"Microsoft.AspNetCore.Server.Kestrel\": \"None\"\r\n      }\r\n    }\r\n  },\r\n  \"AllowedHosts\": \"*\",\r\n  \"CMSHashStringSalt\": \"5a9755b0-10a7-442a-99aa-2d754b1e71ee\",\r\n  \"ConnectionStrings\": {\r\n    \"CMSConnectionString\": \"Data Source=localhost;Initial Catalog=Kentico13Blank;Integrated Security=True;Persist Security Info=False;Connect Timeout=60;Encrypt=False;Current Language=English;\"\r\n  },\r\n  \"CMSCIRepositoryPath\": \"D:\\\\Projects\\\\liamgold\\\\K13\\\\Kentico13\\\\CMS\\\\App_Data\\\\CIRepository\"\r\n}"},"fieldIdentifiers":{"language":"64f2d8d8-6dc5-46d4-85f3-eb50083a6dbd","code":"6a66675c-590a-403a-aecb-2c89a09e3fb7"}}]},{"identifier":"fdc622ab-e118-4e06-b4f6-18be32892f15","type":"Kentico.Widget.RichText","variants":[{"identifier":"f2c3bc7a-6f6f-4ad4-8906-b5a9da112c49","properties":{"content":"<p>The above code block suggests that the logger should only be logging Error level events or above, which is great - it's probably the right setting for most setups and you might not even want to change this. &nbsp;But interestingly with this configuration, the logger still logs Information level events even though they are lower in severity. &nbsp;Shouldn't the logger ignore Information level events here? 🤔</p><p><strong>Scenario 2 - disable all logging</strong></p><p>We could even try taking this one step further, if we set the log level to None then the logger should effectively be disabled. &nbsp;All of the log levels below would be ignored and we shouldn't be getting any debug, information, events or exceptions logged. &nbsp;Lets try this with the following appsettings.json configuration:</p>"},"fieldIdentifiers":{"content":"8c2d274e-cc59-4dd1-9ffd-61cf644c0fd9"}}]},{"identifier":"5d8d7e47-de43-4b76-ae4c-48ca1b6a1c84","type":"Goldfinch.CodeBlockWidget","variants":[{"identifier":"228b74c1-e0a4-4b2b-b9c4-76598c7f0971","properties":{"language":"javascript","code":"{\r\n  \"Logging\": {\r\n    \"LogLevel\": {\r\n      \"Default\": \"None\",\r\n      \"Microsoft\": \"None\",\r\n      \"Microsoft.Hosting.Lifetime\": \"None\"\r\n    },\r\n    \"KenticoEventLog\": {\r\n      \"LogLevel\": {\r\n        \"Default\": \"None\",\r\n        \"Microsoft.AspNetCore.Server.Kestrel\": \"None\"\r\n      }\r\n    }\r\n  },\r\n  \"AllowedHosts\": \"*\",\r\n  \"CMSHashStringSalt\": \"5a9755b0-10a7-442a-99aa-2d754b1e71ee\",\r\n  \"ConnectionStrings\": {\r\n    \"CMSConnectionString\": \"Data Source=localhost;Initial Catalog=Kentico13Blank;Integrated Security=True;Persist Security Info=False;Connect Timeout=60;Encrypt=False;Current Language=English;\"\r\n  },\r\n  \"CMSCIRepositoryPath\": \"D:\\\\Projects\\\\liamgold\\\\K13\\\\Kentico13\\\\CMS\\\\App_Data\\\\CIRepository\"\r\n}"},"fieldIdentifiers":{"language":"7a0d6772-8db9-4d08-bc2f-0208ca1ecf43","code":"82d54958-c616-4330-8670-db7092d0a9da"}}]},{"identifier":"0807dd3f-219f-4fba-a0d3-2bd81eea08bb","type":"Kentico.Widget.RichText","variants":[{"identifier":"70715a32-1a5c-4375-8c40-1eecb81a24e1","properties":{"content":"<p>After calling the different event logger API methods, the end result is:&nbsp;</p>"},"fieldIdentifiers":{"content":"853a6314-ddbd-4c60-af73-5234cb3ee764"}}]},{"identifier":"63156bdd-4784-41f6-ae44-267533ec3496","type":"Goldfinch.ImageWidget","variants":[{"identifier":"1722268a-2479-48ec-8007-7b91c4e29289","properties":{"selectedAssets":[{"identifier":"dabcfd49-b9d5-40f8-b9be-f4403af86b29"}],"image":[],"description":null},"fieldIdentifiers":{"selectedAssets":"269a537b-bf10-4441-ac92-27ac531755dd","image":"9cb99a2b-1719-4433-8f1c-39fb8a6164bf","description":"95a65a44-db25-4e84-8211-908ba935e3d9"}}]},{"identifier":"57938529-e62f-4ef0-9c76-4dca77b410bd","type":"Kentico.Widget.RichText","variants":[{"identifier":"37ff3c4a-6da0-4a41-b4bd-6d2a9ee89b1f","properties":{"content":"<p>So even if we disable all logging, the logger still logs everything done through the API. &nbsp;Interesting! 🤔</p><p><strong>Scenario 3 - try different levels?</strong></p><p>At this point I am starting to assume this is expected functionality by Xperience. &nbsp;Have I misunderstood the .NET Core logging API and the respective log levels? &nbsp;Has the Xperience team made a decision to ignore the level set and to log everything? &nbsp;Is it a bug in their implementation?</p><p>Out of curiosity, I decided to try out all of the .NET Core logging levels - here are my findings:</p><ul><li>Trace (Level 0) - breaks Page Builder, and logs all levels to error log.</li><li>Debug (Level 1) - breaks Page Builder, and logs all levels to error log.</li><li>Information (Level 2) - breaks Page Builder, and logs all levels to error log.</li><li>Warning (Level 3) - logs all levels to error log.</li><li>Error (Level 4) - logs all levels to error log.</li><li>Critical (Level 5) - logs all levels to error log.</li><li>None (Level 6) - logs all levels to error log.</li></ul><p>Something I didn't expect when lowering the log level (e.g. Trace, Debug, and Information), was that the Page Builder would break entirely when visiting the page tab. &nbsp;Instead you are greeted with an error message <strong>InvalidOperationException: User is not authorized to modify current page</strong>.</p>"},"fieldIdentifiers":{"content":"eb77554f-2b02-40cf-aafc-89841486003b"}}]},{"identifier":"f689d5a0-475b-49db-95d4-2c5fe5c8f694","type":"Goldfinch.ImageWidget","variants":[{"identifier":"5d85bfdc-4aa6-4682-8230-9a63fa72f740","properties":{"selectedAssets":[{"identifier":"f188a488-1eb3-4eea-8303-8abcb804633a"}],"image":[],"description":null},"fieldIdentifiers":{"selectedAssets":"c7a7f4b7-6665-456c-a80b-718249eba125","image":"b5eac1c5-26e3-4602-9b9b-ebb46df9370a","description":"9518a980-b7ca-462a-a10f-874a977d5e39"}}]},{"identifier":"44c47690-8e29-41e5-a03b-47ff2cf3d3a4","type":"Kentico.Widget.RichText","variants":[{"identifier":"4973c356-55b0-42d1-bf97-389364c3661f","properties":{"content":"<p>This is something I saw last week on <a href=\"https://twitter.com/ryano9791\" rel=\"noopener noreferrer\" target=\"_blank\">Ryan Overton</a>'s Twitch <a href=\"https://www.twitch.tv/videos/900701900?t=00h29m35s\" rel=\"noopener noreferrer\" target=\"_blank\">stream</a>. &nbsp;If you haven't already - then do check out his streams, they're a great way of getting involved and learning more about Kentico Xperience! 👍</p><p>With all this in mind, my current recommendation would be to leave the log level as the default value of Error. &nbsp;This will ensure your event logging is working correctly, and won't affect the page builder. &nbsp;I guess it's time to discuss this with Kentico Support 👀</p><p><br></p><p><strong>UPDATE!</strong></p><p>After lengthy discussions with Kentico Support, Kentico have now suggested that although the API is built using conventional .NET Core logging API, it does <strong>not&nbsp;</strong>support the use of <strong>IEventLogService</strong>.</p><p>However, they have confirmed that the page builder breaking in <strong>Scenario 3</strong> is a bug and will be hotfixed in 13.0.17 - great result! 😎🎉</p>"},"fieldIdentifiers":{"content":"36126621-4b77-4777-8d11-f276e4190c0b"}}]}]}],"fieldIdentifiers":{}}]}]}]]>
  </ContentItemCommonDataVisualBuilderWidgets>
  <ContentItemReferences>
    <cms.contentitemreference>
      <ContentItemReferenceGroupGUID>269a537b-bf10-4441-ac92-27ac531755dd</ContentItemReferenceGroupGUID>
      <ContentItemReferenceGUID>65607b78-88b4-4d05-b705-fc8ea958771d</ContentItemReferenceGUID>
      <ContentItemReferenceSourceCommonDataID>
        <GUID>56f7ee30-acf4-4972-9103-ed24ee40beb7</GUID>
        <ObjectType>cms.contentitemcommondata</ObjectType>
      </ContentItemReferenceSourceCommonDataID>
      <ContentItemReferenceTargetItemID>
        <CodeName>KenticoXperience13-EventLogging-gsbzthn8</CodeName>
        <GUID>dabcfd49-b9d5-40f8-b9be-f4403af86b29</GUID>
        <ObjectType>cms.contentitem</ObjectType>
      </ContentItemReferenceTargetItemID>
    </cms.contentitemreference>
    <cms.contentitemreference>
      <ContentItemReferenceGroupGUID>c7a7f4b7-6665-456c-a80b-718249eba125</ContentItemReferenceGroupGUID>
      <ContentItemReferenceGUID>a4669452-d72d-4e2f-a09d-ef773c2cc95e</ContentItemReferenceGUID>
      <ContentItemReferenceSourceCommonDataID>
        <GUID>56f7ee30-acf4-4972-9103-ed24ee40beb7</GUID>
        <ObjectType>cms.contentitemcommondata</ObjectType>
      </ContentItemReferenceSourceCommonDataID>
      <ContentItemReferenceTargetItemID>
        <CodeName>KenticoXperience13-UserNotAuthorized-ve9j95xm</CodeName>
        <GUID>f188a488-1eb3-4eea-8303-8abcb804633a</GUID>
        <ObjectType>cms.contentitem</ObjectType>
      </ContentItemReferenceTargetItemID>
    </cms.contentitemreference>
  </ContentItemReferences>
</cms.contentitemcommondata>